<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barcode & QR Code Generator</title>
<style>
  body { font-family: Arial, sans-serif; background: #f8fafc; margin: 0; padding: 0; }
  header { background: #0f172a; color: white; padding: 1rem; text-align: center; display: flex; justify-content: center; align-items: center; gap: 0.5rem; }
  header svg { width: 32px; height: 32px; fill: white; }
  main { max-width: 1000px; margin: auto; padding: 2rem; }
  .controls { display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; margin-bottom: 1rem; }
  .btn { background: #2563eb; color: white; border: none; padding: 0.6rem 1rem; border-radius: 8px; cursor: pointer; }
  .btn:hover { background: #1e40af; }
  .clear-btn { background: #ef4444; }
  .clear-btn:hover { background: #b91c1c; }
  input[type=file] { display: none; }
  label.upload-label { background: #2563eb; color: white; padding: 0.6rem 1rem; border-radius: 8px; cursor: pointer; }
  .form-inline { display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center; margin-bottom: 1rem; }
  .form-inline input, select { padding: 0.4rem; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 0.9rem; }
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 2rem; }
  .card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align: center; position: relative; }
  .delete-btn { position: absolute; top: 5px; right: 5px; background: #ef4444; border: none; border-radius: 50%; width: 24px; height: 24px; color: white; font-weight: bold; cursor: pointer; }
  svg, path { max-width: 100%; height: auto; }
</style>
<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode-svg@1.1.0/lib/qrcode.min.js"></script>
</head>
<body>
<header>
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 4h1v16H3zm2 0h2v16H5zm3 0h1v16H8zm2 0h3v16h-3zm4 0h1v16h-1zm2 0h2v16h-2zm3 0h1v16h-1zm2 0h1v16h-1z"/></svg>
  <h1>Barcode & QR Code Generator</h1>
</header>
<main>
  <div class="controls">
    <label class="upload-label" for="csvFile">Upload CSV</label>
    <input type="file" id="csvFile" accept=".csv" />
    <button class="btn" onclick="downloadTemplate()">Download Template</button>
    <button class="btn" onclick="downloadAllZIP()">Download All as ZIP</button>
    <button class="btn" onclick="downloadAllIndividually()">Download All Individually</button>
  </div>
  <div class="form-inline">
    <label>Type: <select id="typeSelect">
      <option value="barcode">Barcode</option>
      <option value="qrcode">QR Code</option>
    </select></label>
  </div>
  <div class="form-inline">
    <input type="text" id="manualName" placeholder="Name" />
    <input type="text" id="manualCode" placeholder="Code" />
    <button class="btn" onclick="addManual()">Add</button>
    <button class="btn clear-btn" onclick="clearAll()">Clear All</button>
  </div>
  <div class="form-inline">
    <label>Width (mm): <input type="number" id="widthMm" value="55" min="10" /></label>
    <label>Height (mm): <input type="number" id="heightMm" value="11" min="5" /></label>
    <label><input type="checkbox" id="showText" checked /> Show text below barcode</label>
    <label><input type="checkbox" id="nameWithCode" /> Name & Code in filename</label>
  </div>
  <div id="barcodes" class="grid"></div>
</main>
<script>
const code39Map = {
  '0':'nnnwwnwnn','1':'wnnwnnnnw','2':'nnwwnnnnw','3':'wnwwnnnnn','4':'nnnwwnnnw',
  '5':'wnnwwnnnn','6':'nnwwwnnnn','7':'nnnwnnwnw','8':'wnnwnnwnn','9':'nnwwnnwnn',
  'A':'wnnnnwnnw','B':'nnwnnwnnw','C':'wnwnnwnnn','D':'nnnnwwnnw','E':'wnnnwwnnn',
  'F':'nnwnwwnnn','G':'nnnnnwwnw','H':'wnnnnwwnn','I':'nnwnnwwnn','J':'nnnnwwwnn',
  'K':'wnnnnnnww','L':'nnwnnnnww','M':'wnwnnnnwn','N':'nnnnwnnww','O':'wnnnwnnwn',
  'P':'nnwnwnnwn','Q':'nnnnnnwww','R':'wnnnnnwwn','S':'nnwnnnwwn','T':'nnnnwnwwn',
  'U':'wwnnnnnnw','V':'nwwnnnnnw','W':'wwwnnnnnn','X':'nwnnwnnnw','Y':'wwnnwnnnn',
  'Z':'nwwnwnnnn','-':'nwnnnnwnw','.':'wwnnnnwnn',' ':'nwwnnnwnn','$':'nwnwnwnnn',
  '/':'nwnwnnnwn','+':'nwnnnwnwn','%':'nnnwnwnwn','*':'nwnnwnwnn'
};
const MM_TO_PX = 3.78;
let generated = [];

// Generate Code39 SVG
function generateCode39SVG(value,widthMm=55,heightMm=11,showText=true){
  value = value.toUpperCase();
  const text = `*${value}*`;
  const barHeight = heightMm*MM_TO_PX;
  const wide = 3;
  const units=[];
  for(let c of text){
    const p = code39Map[c];
    if(!p) continue;
    for(let i=0;i<p.length;i++) units.push(p[i]==='n'?1:wide);
    units.push(1); // inter-character gap
  }
  units.pop();
  const unitWidth = widthMm*MM_TO_PX/units.reduce((a,b)=>a+b,0);
  let x=0;
  const bars=[];
  for(let c of text){
    const p = code39Map[c];
    if(!p) continue;
    for(let i=0;i<p.length;i++){
      const w = (p[i]==='n'?1:wide)*unitWidth;
      if(i%2===0) bars.push(`<rect x="${x}" y="0" width="${w}" height="${barHeight}" fill="black"/>`);
      x+=w;
    }
    x+=unitWidth;
  }
  const svgHeight = barHeight + (showText?12:0);
  return `<svg xmlns="http://www.w3.org/2000/svg" width="${widthMm*MM_TO_PX}" height="${svgHeight}">
    <rect width="100%" height="100%" fill="white"/>
    ${bars.join('')}
    ${showText?`<text x="${widthMm*MM_TO_PX/2}" y="${barHeight+10}" font-size="10" text-anchor="middle">${value}</text>`:''}
  </svg>`;
}

// Generate QR code SVG
function generateQRCodeSVG(value,widthMm=55){
  const size = widthMm*MM_TO_PX;
  const qr = new QRCode({content:value,width:size,height:size,padding:0});
  return qr.svg();
}

// Render all barcodes/QR codes
function renderBarcodes(data){
  const container = document.getElementById('barcodes');
  container.innerHTML='';
  const widthMm = parseFloat(document.getElementById('widthMm').value)||55;
  const heightMm = parseFloat(document.getElementById('heightMm').value)||11;
  const showText = document.getElementById('showText').checked;
  generated = [];
  data.forEach((item,i)=>{
    let svg='';
    if(item.type==='barcode') svg=generateCode39SVG(item.code,widthMm,heightMm,showText);
    else svg=generateQRCodeSVG(item.code,widthMm);
    if(!svg) return;
    generated.push({...item,svg});
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `${svg}<p>${item.name}</p>`;
    const deleteBtn = document.createElement('button');
    deleteBtn.className='delete-btn';
    deleteBtn.textContent='Ã—';
    deleteBtn.onclick = ()=>removeBarcode(i);
    card.appendChild(deleteBtn);
    const btn = document.createElement('button');
    btn.className='btn';
    btn.textContent='Download';
    btn.onclick = ()=>downloadSingle(item);
    card.appendChild(btn);
    container.appendChild(card);
  });
}

// CSV upload
document.getElementById('csvFile').addEventListener('change',(e)=>{
  const file=e.target.files[0];
  if(!file) return;
  Papa.parse(file,{header:true,skipEmptyLines:true,complete:(results)=>{
    const type=document.getElementById('typeSelect').value;
    const rows = results.data.map(r=>({name:r['Name']||r['name'], code:r['Barcode']||r['barcode'], type:type}));
    renderBarcodes(rows.filter(r=>r.name&&r.code));
  }});
});

// Manual input
function addManual(){
  const name = document.getElementById('manualName').value.trim();
  const code = document.getElementById('manualCode').value.trim();
  const type = document.getElementById('typeSelect').value;
  if(!name || !code){ alert('Please enter both Name and Code'); return; }
  renderBarcodes([...generated,{name,code,type}]);
  document.getElementById('manualName').value='';
  document.getElementById('manualCode').value='';
}

// Remove single
function removeBarcode(index){ generated.splice(index,1); renderBarcodes(generated); }

// Clear all
function clearAll(){ generated=[]; renderBarcodes(generated); }

// Download single
function downloadSingle(item){
  const nameWithCode = document.getElementById('nameWithCode').checked;
  const filenameBase = nameWithCode ? `${item.name} ${item.code}` : item.name;
  const filename = (filenameBase||'code').replace(/[^a-z0-9_-]/gi,'_')+'.svg';
  const blob = new Blob([item.svg],{type:'image/svg+xml;charset=utf-8'});
  saveAs(blob,filename);
}

// Download all individually
function downloadAllIndividually(){
  if(!generated.length){ alert('No codes generated'); return; }
  generated.forEach(item=>downloadSingle(item));
}

// Download CSV template
function downloadTemplate(){
  const csvContent='Name,Barcode\nExample A,ABC123\nExample B,12345\n';
  const blob=new Blob([csvContent],{type:'text/csv;charset=utf-8;'});
  saveAs(blob,'code_template.csv');
}

// Download all as ZIP (optional, requires JSZip if needed)
function downloadAllZIP(){ alert('ZIP download not implemented in this snippet.'); }

</script>
</body>
</html>


